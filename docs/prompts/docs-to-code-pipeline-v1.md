# Docs-to-Code Pipeline System Prompt v1

> **Version:** 1.0.0
> **Updated:** 2025-12-31
> **Based on:** GPT-5.2 Prompt Engineering Patterns + Smart Delta Architecture

---

## System Prompt

```xml
<system>
You are an expert code generator for the InsightPulseAI Docs-to-Code Pipeline. You transform documentation, specifications, and PRDs into production-ready code following the Smart Delta architecture.

<output_verbosity_spec>
  <mode>compact</mode>
  <format>tagged</format>
  <rules>
    - Use code blocks with language hints for all generated code
    - Prefix output sections with XML-like tags: <generated_file>, <explanation>, <validation>
    - Omit boilerplate explanations unless explicitly requested
    - One file per <generated_file> block with full path
    - Include regeneration header in all generated files
  </rules>
</output_verbosity_spec>

<design_and_scope_constraints>
  <scope_discipline>
    - Generate ONLY what is specified in the input documentation
    - Do NOT add features, endpoints, or fields not in the source
    - Do NOT refactor adjacent code unless explicitly requested
    - Preserve existing patterns in the target codebase
  </scope_discipline>

  <smart_delta_rules>
    - Odoo 18 CE first (80% of solutions)
    - OCA modules second (15% of solutions)
    - Custom modules last (5% - only when unavoidable)
    - Custom module naming: ipai_* or insightpulseai_*
    - Follow existing module structure in target repo
  </smart_delta_rules>

  <no_scope_drift>
    Before generating each file, verify:
    1. Is this file explicitly required by the input spec?
    2. Does this modify only the requested functionality?
    3. Are dependencies minimized to what's necessary?
    If any answer is NO, stop and request clarification.
  </no_scope_drift>
</design_and_scope_constraints>

<high_risk_self_check>
  Before finalizing output, self-audit for:
  - [ ] Security: No hardcoded secrets, SQL injection, XSS vectors
  - [ ] Scope: No features beyond specification
  - [ ] Standards: Follows target framework conventions
  - [ ] Tests: Includes test stubs for generated code
  - [ ] Regeneration: Header present in all files
</high_risk_self_check>

<long_context_handling>
  When processing large specifications (>2000 tokens):
  1. Output a numbered outline of planned files first
  2. Use anchors: "### File N of M: path/to/file.py"
  3. Validate each file against the outline before proceeding
  4. Summarize changes at the end with a manifest
</long_context_handling>

<uncertainty_protocol>
  When encountering ambiguity:
  1. State the ambiguity explicitly
  2. List 2-3 reasonable interpretations
  3. State which interpretation you're using and why
  4. Mark with [ASSUMPTION] tag for user review

  Do NOT:
  - Guess at business logic
  - Invent field names not in spec
  - Add "nice to have" features
</uncertainty_protocol>

<regeneration_header>
All generated files MUST include this header (adapted to file type):

Python:
```python
# =============================================================================
# AUTO-GENERATED by InsightPulseAI Docs-to-Code Pipeline
# Source: {source_document}
# Generated: {timestamp}
# DO NOT EDIT DIRECTLY - regenerate from source document
# =============================================================================
```

TypeScript:
```typescript
/**
 * AUTO-GENERATED by InsightPulseAI Docs-to-Code Pipeline
 * Source: {source_document}
 * Generated: {timestamp}
 * DO NOT EDIT DIRECTLY - regenerate from source document
 */
```

YAML:
```yaml
# =============================================================================
# AUTO-GENERATED by InsightPulseAI Docs-to-Code Pipeline
# Source: {source_document}
# Generated: {timestamp}
# DO NOT EDIT DIRECTLY - regenerate from source document
# =============================================================================
```
</regeneration_header>
</system>
```

---

## Model Configuration Matrix

| Task Type | Model | Reasoning Effort | Max Tokens | Notes |
|-----------|-------|------------------|------------|-------|
| **Simple CRUD** | claude-3-5-sonnet | low | 4096 | Standard models, views |
| **Complex Logic** | claude-opus-4 | medium | 8192 | Tax calculations, workflows |
| **Architecture** | claude-opus-4 | high | 16384 | Multi-file generation |
| **Code Review** | claude-3-5-sonnet | medium | 4096 | Validation tasks |
| **Quick Fixes** | claude-3-5-haiku | low | 2048 | Bug fixes, typos |

### Reasoning Effort Settings

```yaml
reasoning_effort:
  low:
    description: "Fast, direct responses for routine tasks"
    use_when:
      - Generating boilerplate code
      - Simple CRUD operations
      - Well-defined templates

  medium:
    description: "Balanced analysis for standard development"
    use_when:
      - Business logic implementation
      - API endpoint design
      - Test generation

  high:
    description: "Deep reasoning for complex problems"
    use_when:
      - Multi-file architecture decisions
      - Security-sensitive code
      - Performance optimization
      - Ambiguous requirements
```

---

## Smart Delta Module Standards

### Module Structure

```
odoo/custom_addons/ipai_{module_name}/
├── __init__.py
├── __manifest__.py
├── models/
│   ├── __init__.py
│   └── {model_name}.py
├── views/
│   └── {model_name}_views.xml
├── security/
│   ├── ir.model.access.csv
│   └── {module_name}_security.xml
├── data/
│   └── {module_name}_data.xml
├── static/
│   └── description/
│       └── icon.png
├── tests/
│   ├── __init__.py
│   └── test_{model_name}.py
└── README.md
```

### Manifest Template

```python
# =============================================================================
# AUTO-GENERATED by InsightPulseAI Docs-to-Code Pipeline
# Source: {source_document}
# Generated: {timestamp}
# DO NOT EDIT DIRECTLY - regenerate from source document
# =============================================================================
{
    'name': 'IPAI {Module Title}',
    'version': '18.0.1.0.0',
    'category': '{Category}',
    'summary': '{One-line description from spec}',
    'description': """
{Multi-line description from spec}
    """,
    'author': 'InsightPulseAI',
    'website': 'https://insightpulse.ai',
    'license': 'LGPL-3',
    'depends': [
        'base',
        # Add only explicitly required dependencies
    ],
    'data': [
        'security/ir.model.access.csv',
        'views/{model_name}_views.xml',
    ],
    'demo': [],
    'installable': True,
    'application': False,
    'auto_install': False,
}
```

### Model Template

```python
# =============================================================================
# AUTO-GENERATED by InsightPulseAI Docs-to-Code Pipeline
# Source: {source_document}
# Generated: {timestamp}
# DO NOT EDIT DIRECTLY - regenerate from source document
# =============================================================================
from odoo import api, fields, models
from odoo.exceptions import ValidationError


class {ModelName}(models.Model):
    _name = 'ipai.{model.name}'
    _description = '{Description from spec}'
    _order = 'name'

    # -------------------------------------------------------------------------
    # FIELDS (from specification)
    # -------------------------------------------------------------------------
    name = fields.Char(
        string='Name',
        required=True,
        help='{Help text from spec}',
    )
    # [GENERATED] Add fields from specification here

    # -------------------------------------------------------------------------
    # CONSTRAINTS
    # -------------------------------------------------------------------------
    _sql_constraints = [
        # [GENERATED] Add constraints from specification here
    ]

    # -------------------------------------------------------------------------
    # COMPUTE METHODS
    # -------------------------------------------------------------------------
    # [GENERATED] Add compute methods here

    # -------------------------------------------------------------------------
    # ACTIONS
    # -------------------------------------------------------------------------
    # [GENERATED] Add action methods here
```

---

## CI/CD Workflow Templates

### Validation Workflow

```yaml
# .github/workflows/docs2code-validate.yml
name: Docs2Code Validation

on:
  push:
    paths:
      - 'docs/specs/**/*.md'
      - 'docs/prds/**/*.md'
  pull_request:
    paths:
      - 'docs/specs/**/*.md'
      - 'docs/prds/**/*.md'

jobs:
  validate-spec:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate Markdown Structure
        run: |
          # Check for required sections
          for file in docs/specs/*.md docs/prds/*.md; do
            if [ -f "$file" ]; then
              echo "Validating: $file"
              grep -q "## Overview" "$file" || echo "Missing: Overview"
              grep -q "## Requirements" "$file" || echo "Missing: Requirements"
              grep -q "## Data Model" "$file" || echo "Missing: Data Model"
            fi
          done

      - name: Check for Code Blocks
        run: |
          # Ensure code blocks have language hints
          grep -rn '```$' docs/specs/ docs/prds/ && exit 1 || echo "All code blocks have language hints"
```

### Generation Workflow

```yaml
# .github/workflows/docs2code-generate.yml
name: Docs2Code Generate

on:
  workflow_dispatch:
    inputs:
      spec_file:
        description: 'Path to specification file'
        required: true
        type: string
      target_module:
        description: 'Target module name (without ipai_ prefix)'
        required: true
        type: string

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Dependencies
        run: pip install anthropic pyyaml

      - name: Generate Code
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          python scripts/docs2code/generate.py \
            --spec "${{ inputs.spec_file }}" \
            --target "odoo/custom_addons/ipai_${{ inputs.target_module }}"

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: 'feat(ipai_${{ inputs.target_module }}): generate from ${{ inputs.spec_file }}'
          title: '[Docs2Code] Generated ipai_${{ inputs.target_module }}'
          body: |
            ## Generated Module

            - **Source:** `${{ inputs.spec_file }}`
            - **Target:** `odoo/custom_addons/ipai_${{ inputs.target_module }}/`

            ## Review Checklist
            - [ ] Code follows Odoo 18 CE conventions
            - [ ] All fields match specification
            - [ ] Security rules are appropriate
            - [ ] Tests are included
          branch: docs2code/ipai_${{ inputs.target_module }}
```

---

## Example Prompts

### Simple Model Generation

```
<task>
Generate an Odoo 18 model from this specification.
</task>

<spec>
Module: BIR 1601C Monthly Remittance
Fields:
- company_id: Many2one to res.company (required)
- period_start: Date (required)
- period_end: Date (required)
- gross_compensation: Monetary
- tax_withheld: Monetary (computed: gross * 0.10)
- status: Selection [draft, submitted, filed]
</spec>

<output_format>
Generate the following files:
1. __manifest__.py
2. models/__init__.py
3. models/bir_1601c.py
4. views/bir_1601c_views.xml
5. security/ir.model.access.csv
</output_format>
```

### Multi-File Architecture

```
<task>
Generate a complete Odoo module for Month-End Close orchestration.
</task>

<spec>
[Large specification - trigger long_context_handling]
</spec>

<output_format>
1. First, output a numbered outline of all files
2. Then generate each file with anchor headers
3. End with a manifest summary
</output_format>
```

---

## Validation Checklist

Before accepting generated code:

### Scope Validation
- [ ] All generated files are in the specification
- [ ] No extra endpoints/fields/features added
- [ ] Dependencies are minimal and necessary

### Code Quality
- [ ] Regeneration header present in all files
- [ ] Follows Odoo 18 CE conventions
- [ ] No hardcoded values (use config/env)
- [ ] Proper error handling

### Security
- [ ] No SQL injection vectors
- [ ] Access rights properly configured
- [ ] Sensitive fields use appropriate widgets

### Testing
- [ ] Test stubs included for all models
- [ ] Edge cases identified in tests
- [ ] Fixtures use realistic data

---

## Integration Points

### With Eric Vyacheslav Catalog Resources

| Pattern | Tool | Integration |
|---------|------|-------------|
| Multi-Agent Orchestration | Vibe Kanban | Parallel generation tasks |
| Repository Intelligence | DeepWiki | Context gathering |
| Document Processing | LangExtract | Spec parsing |
| PRD-to-Code | Claude Code for PMs | Epic decomposition |
| Local RAG | MCP Server | Codebase context |

### With Existing Stack (stack.yaml)

```yaml
integration_points:
  knowledge_pipeline:
    - Query Supabase pgvector for similar patterns
    - Use embedding search for code examples

  skills:
    - Load relevant skills before generation
    - Apply skill templates to output

  ci_cd:
    - Trigger validation workflow on PR
    - Run Odoo tests in CI
```

---

*Part of the InsightPulseAI Docs-to-Code Pipeline*
*See also: repo-structure-and-workflows.md, skills/docs2code/SKILL.md*
